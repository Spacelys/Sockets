steps:
# Install
- name: 'gcr.io/cloud-builders/npm'
  args: ['install']
# Build Step
- name: 'gcr.io/cloud-builders/npm'
  args: ['run', 'build']
# Publish Step (Debug for now)
- name: 'gcr.io/cloud-builders/npm'
  args: ['run', 'debug']
  secretEnv: ['NPM_TOKEN']
# env:
#   - 'NPM_TOKEN=$$NPM_TOKEN'
# Store Step
- name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
  args: ['gsutil', 'cp', '-r', 'dist', 'gs://spacelys/sockets/outputs/$SHORT_SHA/dist']
availableSecrets:
  secretManager:
  - versionName: projects/1088776892318/secrets/spacelys-publish-npm/versions/latest
    env: 'NPM_TOKEN'
